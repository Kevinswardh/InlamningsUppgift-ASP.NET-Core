@model _1.PresentationLayer.ViewModels.ProjectsViewModels.EditProjectViewModel

<!-- EDIT PROJECT MODAL -->
<div class="modal-overlay" id="editProjectModalOverlay">
    <div class="modal" id="editProjectModal">
        <header class="form-header">
            <h1 class="form-title">Edit Project</h1>
            <div class="close-icon-wrapper">
                <img src="https://cdn.builder.io/api/v1/image/assets/2a274513ffcd4318aca721aa009fe223/fbad265fe11d048cf327a34d15de60a4a8ffd228?placeholderIfAbsent=true"
                     alt="Close"
                     class="close-icon" />
            </div>
        </header>

        <form asp-action="Edit" asp-controller="Projects" method="post" enctype="multipart/form-data" class="project-form" style="box-shadow: none;">
            <input type="hidden" asp-for="Id" />
            <input type="hidden" asp-for="ImageUrl" id="editImageUrlHidden" />
            <!-- 🟢 Behåller befintlig bild om ingen ny laddas upp -->

            <section class="image-upload-section">
                <label class="upload-border" for="editProjectImageInput">
                    <img src="@Url.Content(Model.ImageUrl ?? "~/Pictures/Icons/projectlogo.svg")"
                         alt="Upload" class="upload-icon" id="editUploadPreview" />
                    <span class="upload-text">Click to upload icon</span>
                </label>
                <input type="file" id="editProjectImageInput" name="ImageFile" accept="image/*" hidden />
            </section>

            <div class="form-group">
                <label class="form-label">Project Name</label>
                <input type="text" asp-for="Name" class="form-input" placeholder="Project Name" />
            </div>

            <div class="form-group">
                <label class="form-label">Customer Email</label>
                <input type="text" asp-for="ClientEmail" class="form-input" placeholder="Customer Email" />
            </div>

            <div class="form-group">
                <label class="form-label">Description</label>
                <div id="edit-editor-container">
                    <p><br /></p>
                </div>
                <input type="hidden" name="Description" id="edit-hidden-description" />
            </div>

            <div class="date-container">
                <div class="form-group">
                    <label class="form-label">End Date</label>
                    <input type="date" asp-for="EndDate" class="form-input custom-date" />
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Budget</label>
                <input type="number" asp-for="Budget" class="form-input" step="0.01" />
            </div>

            <div class="form-group">
                <label class="form-label">Members</label>
                <div class="members-input">
                    <div class="members-tags" id="editMembersTagsContainer"></div>
                    <input type="text" id="editMemberInput" class="member-input" placeholder="Add member..." />
                    <ul id="editSuggestionsList" class="suggestions-list"></ul>
                </div>
            </div>

            <div id="editMemberHiddenFieldsContainer"></div>

            <button type="submit" class="submit-button">Save changes</button>
        </form>
    </div>
</div>

<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script>
    const editQuill = new Quill("#edit-editor-container", {
        theme: "snow",
        placeholder: "Type something...",
        modules: {
            toolbar: [
                [{ header: [1, 2, false] }],
                ["bold", "italic", "underline"],
                ["blockquote", "code-block"],
                [{ list: "ordered" }, { list: "bullet" }],
                ["clean"],
            ],
        },
    });

    let editSavedRange = null;
    editQuill.on("selection-change", function (range) {
        if (range) editSavedRange = range;
    });

    document.querySelector("#edit-editor-container .ql-toolbar")?.addEventListener("mousedown", function () {
        if (editSavedRange) {
            setTimeout(() => {
                editQuill.setSelection(editSavedRange.index, editSavedRange.length);
            }, 0);
        }
    });

    editQuill.on("text-change", function () {
        document.getElementById("edit-hidden-description").value = editQuill.root.innerHTML;
    });

   

</script>
